# 🎉 File Info Decorator v1.6.2 更新说明

**发布日期：** 2025年11月4日

## 🐛 修复的问题

### 1. ✅ 修复复制路径到Chat功能

**问题描述：**
- 拖放文件到Cursor Chat时，路径格式不正确
- 拖放功能没有考虑用户的路径配置（相对路径 vs 绝对路径）

**解决方案：**
- 修改了`handleDrag`方法，现在会读取`useRelativePathForChat`配置
- 拖放文件到Chat时，会根据配置自动使用相对路径或绝对路径
- 确保拖放和右键复制功能使用相同的路径格式

**代码变更：**
```typescript
// 在handleDrag方法中添加了配置读取
const config = vscode.workspace.getConfiguration('fileInfoDecorator');
const useRelativePath = config.get<boolean>('useRelativePathForChat', true);

const plainTextPaths = source.map(item => {
    if (useRelativePath) {
        const workspaceFolder = vscode.workspace.getWorkspaceFolder(item.resourceUri);
        if (workspaceFolder) {
            return path.relative(workspaceFolder.uri.fsPath, item.resourceUri.fsPath);
        }
    }
    return item.resourceUri.fsPath;
}).join('\n');
```

### 2. ⌨️ 修复Command+Backspace删除快捷键

**问题描述：**
- Mac的`Command+Backspace`删除快捷键不工作
- 其他快捷键（如`Enter`重命名、`Cmd+C`复制等）也无法使用

**解决方案：**
- 修改了所有快捷键命令，使其能够从TreeView的选中项获取要操作的文件
- 现在快捷键调用时，如果没有传入参数，会自动获取当前选中的文件
- 如果没有选中文件，会提示用户先选择

**修改的命令：**
- `fileInfoDecorator.delete` - 删除（Command+Backspace）
- `fileInfoDecorator.rename` - 重命名（Enter）
- `fileInfoDecorator.copy` - 复制（Command+C）
- `fileInfoDecorator.cut` - 剪切（Command+X）
- `fileInfoDecorator.copyPath` - 复制绝对路径（Command+Shift+C）
- `fileInfoDecorator.copyRelativePath` - 复制相对路径（Command+Option+C）

**代码示例：**
```typescript
vscode.commands.registerCommand('fileInfoDecorator.delete', async (item?: FileItem) => {
    // 如果没有传入item（例如通过快捷键调用），尝试获取当前选中的项
    if (!item) {
        const selection = treeView.selection;
        if (!selection || selection.length === 0) {
            vscode.window.showErrorMessage('请先选择要删除的文件或文件夹');
            return;
        }
        item = selection[0];
    }
    // ... 执行删除操作
});
```

### 3. 🎨 优化文件选中的视觉效果

**问题描述：**
- 文件选中时的视觉效果不够明显，显示为浅蓝色
- 希望使用与VSCode原生文件浏览器相同的选中样式

**解决方案：**
- 在`package.json`中添加了颜色主题配置
- 配置TreeView使用与侧边栏相同的背景色
- VSCode会自动应用主题的选中颜色

**代码变更：**
```json
"colors": [
  {
    "id": "fileInfoExplorer.background",
    "description": "文件信息浏览器的背景色",
    "defaults": {
      "dark": "sideBar.background",
      "light": "sideBar.background",
      "highContrast": "sideBar.background"
    }
  }
]
```

## 📋 完整的快捷键列表

现在所有快捷键都可以正常使用了！

| 快捷键 (Mac) | 快捷键 (Win/Linux) | 功能 |
|-------------|------------------|------|
| `Command+Backspace` | `Delete` | 删除文件/文件夹 |
| `Enter` | `Enter` | 重命名 |
| `Command+C` | `Ctrl+C` | 复制文件 |
| `Command+X` | `Ctrl+X` | 剪切文件 |
| `Command+V` | `Ctrl+V` | 粘贴文件 |
| `Command+Shift+C` | `Ctrl+Shift+C` | 复制绝对路径 |
| `Command+Option+C` | `Ctrl+Alt+C` | 复制相对路径 |
| `Command+Option+R` | `Ctrl+Alt+R` | 在Finder/资源管理器中显示 |

## 🚀 使用方法

### 安装新版本

```bash
cd /Users/felix/Desktop/宝宝/xxhFD

# 方法1：使用build脚本（推荐）
./build.sh

# 方法2：手动安装
code --install-extension file-info-decorator-1.6.2.vsix
```

### 重新加载VSCode/Cursor

安装后，按 `Command+Shift+P` (Mac) 或 `Ctrl+Shift+P` (Win/Linux)，输入 "Reload Window" 并回车。

### 测试快捷键

1. **测试删除快捷键：**
   - 在"文件信息浏览器"中选中一个文件
   - 按 `Command+Backspace` (Mac) 或 `Delete` (Win/Linux)
   - 应该弹出删除确认对话框

2. **测试重命名：**
   - 选中文件
   - 按 `Enter`
   - 应该弹出重命名输入框

3. **测试复制路径到Chat：**
   - 方式1：右键文件 → "复制路径到Chat"
   - 方式2：拖放文件到Cursor Chat输入框
   - 路径应该根据配置使用相对路径或绝对路径

### 配置Chat路径格式

在VSCode/Cursor设置中搜索 `File Info Decorator`：

```json
{
  // 使用相对路径（默认）
  "fileInfoDecorator.useRelativePathForChat": true
  
  // 使用绝对路径
  "fileInfoDecorator.useRelativePathForChat": false
}
```

## 🔍 技术细节

### 修改的文件

1. **src/extension.ts**
   - 修改了`handleDrag`方法（第696-720行）
   - 修改了7个命令处理函数，添加了TreeView选中项获取逻辑
   - 删除命令（第145-178行）
   - 重命名命令（第180-219行）
   - 复制路径命令（第221-236行）
   - 复制相对路径命令（第283-306行）
   - 剪切命令（第300-318行）
   - 复制命令（第320-337行）

2. **package.json**
   - 版本号更新为 1.6.2（第5行）
   - 添加了颜色主题配置（第360-370行）

### 代码行数

- 总代码行数：~950行
- 修改的行数：~100行
- 新增的行数：~50行

## 📝 测试建议

1. **路径复制测试：**
   - 创建一个测试文件
   - 右键 → "复制路径到Chat"
   - 检查剪贴板内容是否为相对路径
   - 修改配置为绝对路径后再测试

2. **拖放测试：**
   - 从"文件信息浏览器"拖动文件到Cursor Chat
   - 检查粘贴的路径格式
   - 尝试拖动多个文件

3. **快捷键测试：**
   - 测试所有快捷键是否响应
   - 测试在未选中文件时按快捷键，是否显示提示
   - 测试选中文件后按快捷键，是否执行操作

## 🙏 反馈

如果发现任何问题，请提供以下信息：
- 操作系统版本
- VSCode/Cursor版本
- 具体的操作步骤
- 错误信息（如果有）

---

**版本：** 1.6.2  
**打包文件：** `file-info-decorator-1.6.2.vsix`  
**文件大小：** 198 KB (19个文件)





